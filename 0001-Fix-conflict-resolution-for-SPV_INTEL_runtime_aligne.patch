From d3318dba8f8c3dd5166076093761b6ad4c019f91 Mon Sep 17 00:00:00 2001
From: "Maksimova, Viktoria" <viktoria.maksimova@intel.com>
Date: Thu, 4 Jul 2024 03:14:03 -0700
Subject: Fix conflict resolution for SPV_INTEL_runtime_aligned patch


Original commit:
https://github.com/KhronosGroup/SPIRV-LLVM-Translator/commit/d3318db
---
 llvm-spirv/lib/SPIRV/SPIRVReader.cpp                          | 4 ++++
 .../INTEL/SPV_INTEL_runtime_aligned/RuntimeAligned.spt        | 1 -
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/llvm-spirv/lib/SPIRV/SPIRVReader.cpp b/llvm-spirv/lib/SPIRV/SPIRVReader.cpp
index 9ae56b9f6ec6..752abc9ccc75 100644
--- a/llvm-spirv/lib/SPIRV/SPIRVReader.cpp
+++ b/llvm-spirv/lib/SPIRV/SPIRVReader.cpp
@@ -3034,6 +3034,10 @@ Function *SPIRVToLLVM::transFunction(SPIRVFunction *BF) {
     mapValue(BA, &(*I));
     setName(&(*I), BA);
     BA->foreachAttr([&](SPIRVFuncParamAttrKind Kind) {
+      // Skip this function parameter attribute as it will translated among
+      // OpenCL metadata
+      if (Kind == FunctionParameterAttributeRuntimeAlignedINTEL)
+        return;
       Attribute::AttrKind LLVMKind = SPIRSPIRVFuncParamAttrMap::rmap(Kind);
       Type *AttrTy = nullptr;
       switch (LLVMKind) {
diff --git a/llvm-spirv/test/extensions/INTEL/SPV_INTEL_runtime_aligned/RuntimeAligned.spt b/llvm-spirv/test/extensions/INTEL/SPV_INTEL_runtime_aligned/RuntimeAligned.spt
index 4999d2f835ef..9f7775fb5974 100644
--- a/llvm-spirv/test/extensions/INTEL/SPV_INTEL_runtime_aligned/RuntimeAligned.spt
+++ b/llvm-spirv/test/extensions/INTEL/SPV_INTEL_runtime_aligned/RuntimeAligned.spt
@@ -1,4 +1,3 @@
-; XFAIL: *
 ; RUN: llvm-spirv -spirv-text -r %s -o %t.bc
 ; RUN: llvm-dis < %t.bc | FileCheck %s --check-prefix=CHECK-LLVM
 
-- 
2.39.1

